# Femock MCP: 架构与设计文档

## 1. 概述

`femock` 是一个面向前端开发者的模拟面试 MCP (Meta Command Palette) 工具。它通过模拟多轮技术面试和 HR 面试，帮助用户熟悉面试流程、检验知识掌握程度，并提升面试表现。

## 2. 核心设计理念：静态与动态结合的混合模式

整个模拟面试流程将由一个**任务文件（Task File）** 驱动。这个文件（例如 `task.json`）是整个流程的状态机和数据中心。

我们采用一种**混合模式**来设计面试流程，以平衡**流畅性**和**互动性**：

- **静态生成 (为主):** 在分析阶段，一次性生成所有面试轮次的**核心问题**。这保证了面试结构完整、流程顺畅，避免了用户在回答每个问题后都要等待 AI 响应。
- **动态追问 (为辅):** 在用户回答完一个核心问题后，提供**可选的**深入追问功能。只有当用户主动选择时，才会进行实时的、针对性更强的 AI 调用，以模拟真实面试中的动态追问环节。

这种设计的优势在于：
- **核心体验流畅:** 主要流程无延迟，保证了面试的沉浸感。
- **兼具互动深度:** 在用户需要时，可以深入挖掘知识点，实现高度仿真的互动。
- **成本可控:** 将高成本的 AI 动态调用限制在必要环节。
- **持久化与透明化:** 所有数据（包括动态追问）都会被记录在任务文件中。

## 3. 核心数据结构：任务文件 (`task.json`)

任务文件是设计的核心，其主要结构如下（注意 `interviewTranscript` 的变化）：

```json
{
  "taskId": "unique-task-id-timestamp",
  "createdAt": "2025-08-31T10:00:00Z",
  "status": "pending_analysis" | "analysis_complete" | "round1_inprogress" | "...",
  "userInput": {
    "resumePath": "/path/to/user/resume.pdf",
    "jdPath": "/path/to/user/jd.txt",
    "selfIntroductionPath": "/path/to/user/self-intro.txt"
  },
  "analysisOutput": {
    "summary": "AI对用户简历和JD的综合分析摘要...",
    "interviewRounds": [
      {
        "round": 1,
        "title": "技术同事面 (底层技术)",
        "interviewerProfile": "...",
        "questions": [
          { "id": 1, "text": "请解释一下浏览器事件循环（Event Loop）的执行机制。" }
        ]
      }
    ]
  },
  "interviewTranscript": [
    {
      "transcriptId": "t1",
      "round": 1,
      "questionId": 1,
      "questionText": "请解释一下浏览器事件循环（Event Loop）的执行机制。",
      "userAnswer": "...",
      "aiFeedback": "..."
    },
    {
      "transcriptId": "t2",
      "parentTranscriptId": "t1",
      "round": 1,
      "questionId": null,
      "questionText": "你刚才提到了微任务，能详细解释一下它和宏任务的区别吗？",
      "userAnswer": "...",
      "aiFeedback": "..."
    }
  ]
}
```

## 4. 工作流程 (5个阶段)

`femock` 的执行流程将通过不同的命令串联起来。

### 阶段一: 初始化与分析 (`femock create & femock analyze`)

1.  **`femock create`**:
    - 用户提供简历、JD 等文件路径。
    - MCP 创建 `task-{timestamp}.json` 文件，存入 `userInput`。
    - 状态 `status` 设为 `pending_analysis`。

2.  **`femock analyze`**:
    - MCP 读取任务文件。
    - **根据第 6 节定义的 Prompt 模板**，为四个面试阶段分别调用 AI 服务。
    - AI 分析材料，为所有4轮面试生成对应的**核心面试题**。
    - MCP 将结果写入 `analysisOutput`。
    - 更新 `status` 为 `analysis_complete`。

### 阶段二至五: 模拟面试 (`femock start --round <number|hr>`)

1.  **`femock start --round 1`**:
    - 用户指定开始第一轮面试。
    - MCP 读取任务文件，加载该轮次的核心问题。
    - 系统进入交互式问答循环：
        a.  向用户展示一个**核心问题**。
        b.  用户输入回答。
        c.  系统记录问答内容到 `interviewTranscript`。
        d.  系统向用户提供选项：
            - `[c]ontinue`: 继续下一个核心问题。
            - `[d]ig deeper`: 就刚才的回答深入追问。
        e.  如果用户选择 `[d]ig deeper`：
            - MCP 将当前问题和用户的回答作为上下文，**实时调用 AI** 生成一个追问。
            - 该追问及用户的回答，会作为一条新的记录（带有 `parentTranscriptId`）存入 `interviewTranscript`。
            - 追问结束后，返回主流程，继续下一个核心问题。
    - 完成所有核心问题后，更新 `status` 为 `round1_complete`。

2.  后续面试轮次重复此过程。

## 5. 预期的目录结构

```
mcps/femock/
├── src/
│   ├── commands/      # 存放各命令的实现 (create, analyze, start)
│   ├── lib/           # 核心逻辑 (AI交互, 文件处理)
│   └── index.ts       # MCP 入口文件
├── materials/         # AI 物料库 (知识库)
│   └── algorithms/    # 算法题库
│       ├── debounce.md
│       └── ...
├── tasks/             # 存放生成的任务文件 (应加入 .gitignore)
│   └── task-1693456800.json
├── package.json
├── tsconfig.json
└── DESIGN.md          # 本设计文档
```

## 6. AI 物料库 (Materials)

为了给 AI 提供高质量、结构化的知识，以生成更精准的面试题并支持后续的评分功能，我们引入了物料库。

- **`materials/algorithms`**: 存放精选的前端高频算法题。每道题是一个独立的 Markdown 文件，包含题目描述、要求和标准解法代码。这将作为 AI 出题和评估用户代码的主要参考。

## 7. AI Prompt 设计

为了确保各轮面试的质量和针对性，我们需要为每一轮面试设计独立的 Prompt。这些 Prompt 将在 `analyze` 阶段被调用。在调用时，可以**引用物料库**中的内容来丰富题目的生成。

### 通用指令
- **输入:** 用户的简历内容、岗位JD、自我介绍、**相关的物料库内容**。
- **输出:** 一个包含 5-8 个问题的 JSON 数组，格式为 `[{ "id": 1, "text": "..." }, ...]`。
- **要求:** 问题需要紧密结合用户简历中提到的项目和技能，以及岗位 JD 的要求。

---

### Prompt 1: 技术同事面 (Round 1)

- **面试官角色:** 你是一名资深前端工程师，你正在面试一位未来的技术同事。
- **考察目标:** 评估候选人的前端基础知识是否扎实，技术原理是否清晰。
- **核心领域:**
    - JavaScript 核心（事件循环、作用域、闭包、原型链）。
    - CSS 深度问题（盒模型、Flex/Grid 布局、选择器优先级）。
    - 框架/库的底层原理（例如 React Hooks 的实现机制，Vue 的响应式原理）。
    - 浏览器工作原理（渲染流程、性能优化）。
- **指令:** "请根据候选人的简历和JD，并参考物料库中的算法题，设计 5-8 个问题，深入挖掘他/她的技术底层知识。**请务必包含 1-2 道与前端场景相关的数据结构或算法题。** 避免提过于宽泛的架构问题。"

---

### Prompt 2: 直属领导面 (Round 2)

- **面试官角色:** 你是一名技术团队的 Leader (直属领导)，正在寻找能够解决实际业务问题的得力干将。
- **考察目标:** 评估候选人运用技术解决业务问题的能力，以及其项目经验的真实性。
- **核心领域:**
    - 将简历中的项目经验与业务场景结合进行提问。
    - 实际问题解决（例如：如何设计一个复杂表单/可复用组件库？）。
    - 性能优化实践（例如：如何处理首屏加载慢的问题？）。
    - 代码质量与可维护性（Code Review、测试策略）。
    - 技术选型与权衡 (Trade-offs)。
- **指令:** "请根据候选人的简历和JD，并参考物料库，设计 5-8 个问题。问题应侧重于将技术应用于实际业务场景，并考察其在过去项目中的决策和思考过程。**请务- 必包含 1-2 道能体现候选人解决实际问题能力的算法题。**"

---

### Prompt 3: 总监/架构师面 (Round 3)

- **面试官角色:** 你是一名技术总监或架构师，负责团队的技术远景和架构设计。
- **考察目标:** 评估候选人的架构设计能力、项目全局观、技术领导力和沟通协作能力。
- **核心领域:**
    - 前端架构设计（微前端、Monorepo）。
    - 跨团队协作与沟通。
    - 项目管理与风险评估（如何推动一个复杂项目上线？）。
    - 技术深度与广度（对前端生态的理解，对未来的思考）。
    - 解决复杂问题的能力和系统性思维。
- **指令:** "请根据候选人的简历和JD，并参考物料库，设计 5-8 个问题。问题应具有高度和广度，侧重于考察候选人的架构思维、项目领导力以及处理复杂和模糊问题的能力。**可以包含 1-2 道与系统设计、性能优化相关的复杂算法问题。**"

---

### Prompt 4: HR 面

- **面试官角色:** 你是公司的 HR。
- **考察目标:** 评估候选人的软实力、职业动机、团队合作精神以及与公司文化的匹配度。
- **核心领域:**
    - 职业规划与动机。
    - 团队协作与冲突解决。
    - 学习能力与抗压能力。
    - 对过往经历的复盘与思考。
- **指令:** "请设计 5-8 个行为面试问题（Behavioral Questions），以评估候选人的软实力和文化契- 合度。问题应引导候选人分享具体的过往经历。"
